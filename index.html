<!DOCTYPE html> 
<html> 
	<head> 
	<title>English irregular verbs</title> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0b1/jquery.mobile-1.0b1.min.css" />
        <script src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.0b1/jquery.mobile-1.0b1.min.js"></script>
                
        <script src="js/jquery/jquery-ui-1.8.13.bounceEffect.min.js"></script>
                
        <!-- kibo -->      
        <script src="js/dictionary.js"></script>
	
	<style>						
                .tenses div{
                    width:20%;
                    height:5em;
                    background:green;
                    margin-bottom:1em;
                }
                
                .options div{
                    width:10%;
                    height:2em;
                    background:yellow;
                    margin-bottom:1em;
                }
                                                 
               .center{text-align: center;}
               
               #nextButton{                                           
                   display:none;
               }
                              
	</style>
	
    <script> 
        //## SETUP #####################
        var lives = localStorage.getItem("lives") != null ? localStorage.getItem("lives") : 3; // 1, 2, 3        
        var countOfVerbs = localStorage.getItem("countOfVerbs") != null ? localStorage.getItem("countOfVerbs") : 10; // 10, 20, 30, 50, 100
        
        var bonus = 0;       
        var difficulty = 2; // 0,1,2      
                
       //##############################
       var dictionary = new Dictionary();
                                        
       function lockTenses(){
           for(var i = 0; i<=2; i++){               
               $("#tense" + i).attr("ondragover", "return true");
           }           
       }
       
       function unlockTenses(){
           for(var i = 0; i<=2; i++){   
               $("#tense" + i).text("");
               $("#tense" + i).attr("ondragover", "return false");
           }           
       }
                    
       function showOptions(){     
           $('.options').empty();
           var options = dictionary.getOptions( difficulty );
           for(var i = 0; i <= ( options.length - 1 ); i++){                              
               $('.options').append("<div draggable=\"true\" ondragstart=\"return start(event)\" >" + options[i] + "</div>");                                                         
           }                      
       }
              
       function showTense(){            
           unlockTenses();
           var random = dictionary.random();
           var tense = dictionary.getVerb().tenses[random];
           var selector = "#tense" + random;
           $( selector ).text( tense );
           $( selector ).attr("ondragover", "return true");
           
           showOptions();              
       }
                    
       function nextVerb(){
           dictionary.idx.next();
           showTense();           
           switchVisibility();
       }
       
       function showStatus(){                      
          $(".bonus").text( bonus );
          $(".lives").text( lives );   
          checkStatus(); 
       }
       
       function checkStatus(){         
           if(lives <= 0){                              
               $("#state").text( "GAME OVER!" );
               $.mobile.changePage("#gameover");
           }else if( dictionary.idx.get() >= countOfVerbs-1){              
               $(".bonus").text( (bonus * lives) );
               $("#state").text( "YOU ARE WINNER!" );
               $.mobile.changePage("#gameover");
           }           
       }
                    
       function check(){
           var isError = false;
           for(var i = 0; i<=2; i++){                 
                if( $("#tense" + i).text() != dictionary.getVerb().tenses[i] ){
                    isError = true;
                    $("#tense" + i ).effect("bounce", { times:3 }, 200);                
                }                  
           } 
           
           (isError) ? lives-- : bonus++ ;
           showStatus();           
           switchVisibility();                     
       }
       
       function switchVisibility(){
           if (  $("#nextButton").is(':hidden') ){            
              $("#nextButton").show();
           }else{
               $("#nextButton").hide();              
           }                     
       }
       
       function start(e) {        
                e.dataTransfer.setData("text",  $(e.target).text() );                   
                return true;
              }

       function drop(e) {
                e.stopPropagation();
                e.preventDefault();
                var text = e.dataTransfer.getData("text");
                $(e.target).text(text);  
                
                if ($("#tense0").text() && 
                    $("#tense1").text() && 
                    $("#tense2").text() ){
                      lockTenses();
                      check();
                }                              
       }
       
       function setOptions(){
           $("#select-lives").val( lives );
           $("#select-verbs").val( countOfVerbs );                
       }
                                                 
       $(document).ready(function() {                                                               
           dictionary.init();
           showStatus();
           showTense();             
           createTopTenList();
           setOptions();           
        });
        
        function createTopTenList(){
            dictionary.checkResults();
            $("#toptenList").empty();
            var keys = dictionary.getSortedKeys();   
            var results = JSON.parse( localStorage.getItem("results") );
            for (i=0; i<=keys.length-1; i++){		
                var bonus =  keys[i];
		var name = results[bonus];             
                $("#toptenList").append("<div>" + name + " "+  bonus + "</div>");
             } 
        }
        
        function saveResult(){
            var bonus = $(".bonus:first").text();
            var name = $("#name").attr("value");
            dictionary.saveResults( bonus, name );   
            createTopTenList();
            $.mobile.changePage("#topten");
        }
        
       function setOption( id ){
           var name = $(id).attr("name"); 
           var value = $(id).val();
           localStorage.setItem( name, value );
       }
                     
    </script>	
			
</head> 
<body> 
    
 <div data-role="page" data-theme="b" id="home">
     
      <div data-role="header" data-position="fixed">            
            <h1>Home</h1>					           
    </div><!-- /header -->

    <div data-role="content" >	
	                         
            <a href="#game" data-role="button" >Game</a>            
            <a href="#topten" data-role="button">Top ten</a>
            <a href="#search" data-role="button" >Search</a> 
            <a href="#about" data-role="button">About</a>           
        	
    </div><!-- /content -->

   <div data-role="footer" data-position="fixed"  class="ui-bar">         
        <a href="#options" data-role="button" data-icon="gear">Options</a>                                                              
    </div><!-- /footer -->
        
 </div> <!-- /home -->
 
 
  <div data-role="page" data-theme="b" id="topten">
     
      <div data-role="header" data-position="fixed"> 
            <a href="#home" onclick="window.location.href='index.html'" data-role="button" data-icon="home" data-iconpos="notext" title="home">Home</a>            
            <h1>Top ten</h1>					           
    </div><!-- /header -->

    <div data-role="content" >	
	          
        <div id="toptenList"></div>       
        	
    </div><!-- /content -->

   <div data-role="footer" data-position="fixed" class="ui-bar" data-inline="true">                                                                            
    </div><!-- /footer -->
        
 </div> <!-- /result -->
  
<div data-role="page" data-theme="b" id="game">

    <div data-role="header" data-position="fixed">
            <a href="#home" onclick="window.location.href='index.html'" data-role="button" data-icon="home" data-iconpos="notext" title="home">Home</a> 
            <h1>Game</h1>					           
    </div><!-- /header -->

    <div data-role="content" >	
	  
        <div class="tenses">
            <div id="tense0" ondragover="return false" ondrop="return drop(event)" ></div>
            <div id="tense1" ondragover="return false" ondrop="return drop(event)" ></div>
            <div id="tense2" ondragover="return false" ondrop="return drop(event)" ></div>
        </div>

        <div class="options"></div>
                               
        <div class="ui-grid-a" >
            <div class="ui-block-a"><button type="button" data-theme="c" data-icon="info" data-iconpos="right" title="Speech">Sound</button></div>
            <div class="ui-block-b"><div id="nextButton"><button type="button" data-theme="b" onclick="nextVerb()" data-icon="arrow-r" data-iconpos="right" title="Next"  >Next</button></div></div>	   
        </div>                        
	
    </div><!-- /content -->

    <div data-role="footer" data-position="fixed" class="ui-bar" data-inline="true">        
        <div class="ui-grid-a">
            <div class="ui-block-a"><span class="bonus" ></span></div>
            <div class="ui-block-b"><span class="lives"></span></div>	   
        </div>                                                               
    </div><!-- /footer -->

</div><!-- /game -->


<div data-role="page" data-theme="b" id="gameover">
        
    <div data-role="header" data-position="fixed">
            <a href="#home" onclick="window.location.href='index.html'"  data-role="button" data-icon="home" data-iconpos="notext" title="home">Home</a> 
            <h1>Game over</h1>					           
    </div><!-- /header -->

    <div data-role="content" >	
	         
        <h2 id="state" class="center"></h2>
        <h4 class="bonus center"></h4>
                                      
        <div data-role="fieldcontain">            
        	<label for="name">Name:</label>
                <input type="text" name="name" id="name" value="" placeholder="your name"  />                  
         
                <div class="ui-grid-a">
                    <div class="ui-block-a"><button type="button" data-theme="c" onclick="window.location.href='index.html'">Cancel</button></div>
                    <div class="ui-block-b"><button onclick="saveResult();" type="button" data-theme="b">Save</button></div>	   
                </div>
        </div> 
                	
    </div><!-- /content -->

     <div data-role="footer" data-position="fixed" class="ui-bar" data-inline="true">                                                                              
    </div><!-- /footer -->
            
</div> <!-- /gameOver -->

<div data-role="page" data-theme="b" id="options">
        
    <div data-role="header" data-position="fixed">
            <a href="#home" onclick="window.location.href='index.html'"  data-role="button" data-icon="home" data-iconpos="notext" title="home">Home</a> 
            <h1>Options</h1>					           
    </div><!-- /header -->

    <div data-role="content" >
        
         <div data-role="fieldcontain">
            <label for="select-lives" class="select">Count of lives:</label>
            <select name="lives" id="select-lives" data-native-menu="false" onchange="setOption( this );">
                <option value="3">3 lives</option>  
                <option value="2">2 lives</option>
                <option value="1">1 live</option>                                                                         
            </select>
        </div>
                                                
        <div data-role="fieldcontain">
            <label for="select-verbs" class="select">Count of verbs:</label>
            <select name="countOfVerbs" id="select-verbs" data-native-menu="false" onchange="setOption( this );">                    
                    <option value="10">10 verbs</option>
                    <option value="20">20 verbs</option>
                    <option value="30">30 verbs</option>
                    <option value="30">40 verbs</option>
                    <option value="30">50 verbs</option>
                    <option value="100">100 verbs</option>
            </select>
        </div>
               	                                        
    </div><!-- /content -->

     <div data-role="footer" data-position="fixed" class="ui-bar" data-inline="true">        
                                                                     
    </div><!-- /footer -->
            
</div> <!-- /options -->


</body>
</html>
